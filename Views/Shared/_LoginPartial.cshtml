

@using Microsoft.AspNetCore.Identity
@using AspNetCore_MVC_Project.Models
@using AspNetCore_MVC_Project.Data
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
@inject ApplicationDbContext DbContext

@functions {
    public async Task<string> GetCompanyName(ApplicationUser user)
    {
        if (user?.CompanyId != null)
        {
            var company = await DbContext.Companies.FindAsync(user.CompanyId);
            return company?.Name ?? "No Company";
        }
        return "No Company";
    }


}



<ul class="navbar-nav">
    @if (SignInManager.IsSignedIn(User))
    {
        var user = await UserManager.GetUserAsync(User);

        if (user != null) {
            @* var companyName = "No Company"; // Значение по умолчанию

            if (user?.CompanyId != null)
            {
                var company = await DbContext.Companies.FindAsync(user.CompanyId);
                if (company != null)
                {
                    companyName = company.Name;
                }
            } *@
            var companyName = await GetCompanyName(user);

            <li class="nav-item">
                <span class="nav-link">
                    Hello, <string>@user.UserName</string> from @companyName!
                </span>
            </li>
            <li class="nav-item">
                <form asp-area="" asp-controller="Account" asp-action="Logout" method="post">
                    <button type="submit" class="btn btn-link nav-link">Logout</button>
                </form>
            </li>
        } else
        {
            <!-- default -->
            @await Html.PartialAsync("_LoginRegisterLinks")
        }
    }
    else
    {
        <!-- default -->
        @await Html.PartialAsync("_LoginRegisterLinks")
    }
</ul>
